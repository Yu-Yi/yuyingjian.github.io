I"ïf<ul id="markdown-toc">
  <li><a href="#dedicated-workers" id="markdown-toc-dedicated-workers">Dedicated workers</a>    <ul>
      <li><a href="#worker-ç‰¹æ€§æ£€æµ‹" id="markdown-toc-worker-ç‰¹æ€§æ£€æµ‹">worker ç‰¹æ€§æ£€æµ‹</a></li>
      <li><a href="#ä½¿ç”¨-worker" id="markdown-toc-ä½¿ç”¨-worker">ä½¿ç”¨ worker</a></li>
      <li><a href="#ä¸“ç”¨-worker-æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€" id="markdown-toc-ä¸“ç”¨-worker-æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€">ä¸“ç”¨ worker æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€</a></li>
      <li><a href="#ç»ˆæ­¢-worker" id="markdown-toc-ç»ˆæ­¢-worker">ç»ˆæ­¢ worker</a></li>
      <li><a href="#å¼•å…¥-subworker" id="markdown-toc-å¼•å…¥-subworker">å¼•å…¥ subworker</a></li>
      <li><a href="#worker-çš„å…¨å±€ä½œç”¨åŸŸ" id="markdown-toc-worker-çš„å…¨å±€ä½œç”¨åŸŸ">worker çš„å…¨å±€ä½œç”¨åŸŸ</a></li>
    </ul>
  </li>
  <li><a href="#shared-workers" id="markdown-toc-shared-workers">Shared workers</a>    <ul>
      <li><a href="#ç”Ÿæˆä¸€ä¸ª-shared-worker" id="markdown-toc-ç”Ÿæˆä¸€ä¸ª-shared-worker">ç”Ÿæˆä¸€ä¸ª Shared worker</a></li>
      <li><a href="#å…±äº«-worker-ä¸­æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€" id="markdown-toc-å…±äº«-worker-ä¸­æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€">å…±äº« worker ä¸­æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€</a></li>
      <li><a href="#ä¾‹å­" id="markdown-toc-ä¾‹å­">ä¾‹å­</a></li>
    </ul>
  </li>
  <li><a href="#service-workers" id="markdown-toc-service-workers">Service workers</a></li>
</ul>

<p>Web Worker çš„å¼•å…¥æ˜¯å› ä¸º JavaScript çš„å•çº¿ç¨‹é—®é¢˜ï¼Œä½¿å¤§è®¡ç®—é‡çš„é—®é¢˜ä¼šé€ æˆé¡µé¢é˜»å¡ã€‚ä¸ºæ­¤ï¼ŒHTML 5 åˆ¶è®¢äº† Web Worker æ ‡å‡†ï¼Œé€šè¿‡åˆ›å»º<strong>å·¥ä½œçº¿ç¨‹</strong>æ¥è¿›è¡Œè®¡ç®—ã€‚</p>

<p>Web Workers ä¸€èˆ¬è¯´æ¥åˆ†ä¸ºä¸‰ç±»ï¼š</p>

<ul>
  <li>Dedicated workers: ä¸“ç”¨ workersï¼ŒDedicated workers åªèƒ½è¢«åˆ›å»ºå®ƒçš„ JavaScript æ‰€è°ƒç”¨ã€‚å®ƒä»¬æ˜¯ä¸“é—¨ä¸ºæŸä¸ªç‰¹å®šçš„é¡µé¢æœåŠ¡çš„ï¼Œä¸èƒ½åœ¨é¡µé¢ä¸­å…±äº«ã€‚</li>
  <li>Shared workers: å…±äº« workersï¼ŒShared worker å¯ä»¥å¤šä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œæ‰€æœ‰è¿™äº›æµè§ˆå™¨ä¸Šä¸‹æ–‡å¿…é¡»åŒæº(ç›¸åŒçš„åè®®ï¼Œä¸»æœºå’Œç«¯å£å·)ã€‚</li>
  <li>Service workers</li>
</ul>

<!-- more -->

<h2 id="dedicated-workers">Dedicated workers</h2>

<h3 id="worker-ç‰¹æ€§æ£€æµ‹">worker ç‰¹æ€§æ£€æµ‹</h3>

<p>ä¸ºäº†å¤„ç†å‘ä¸‹å…¼å®¹ï¼Œè¿™æ ·æ˜¯æœ‰å¿…è¦çš„ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Worker</span><span class="p">){</span>
    <span class="c1">//do something</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨-worker">ä½¿ç”¨ worker</h3>

<p>å®ä¾‹åŒ– Worker å¯¹è±¡ï¼Œå¹¶ä¼ å…¥è¦æ‰§è¡Œçš„ JavaScript æ–‡ä»¶åã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="dl">"</span><span class="s2">worker.js</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="ä¸“ç”¨-worker-æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€">ä¸“ç”¨ worker æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€</h3>

<p>Worker æ˜¯é€šè¿‡ message å’Œ error äº‹ä»¶ä¸é¡µé¢é€šä¿¡çš„ã€‚é€šè¿‡ postMessage() ä¼ é€’æ•°æ®ï¼Œè¯¥æ•°æ®ä¿å­˜åœ¨ event.data ä¸­ã€‚</p>

<blockquote>
  <p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒpostMessage() å¯ä»¥è¿›è¡Œçˆ¶å­æ•°æ®ä¼ é€’ï¼Œmessage å’Œ error äº‹ä»¶éƒ½å¯ä»¥åœ¨çˆ¶å­ä¹‹é—´å‘ç”Ÿã€‚</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;p&gt;</span>Count numbers: <span class="nt">&lt;output</span> <span class="na">id=</span><span class="s">"result"</span><span class="nt">&gt;&lt;/output&gt;&lt;/p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"startWorker()"</span><span class="nt">&gt;</span>Start Worker<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"stopWorker()"</span><span class="nt">&gt;</span>Stop Worker<span class="nt">&lt;/button&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">worker</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">startWorker</span><span class="p">()</span>
<span class="p">{</span>
<span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Worker</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">worker</span><span class="p">)</span><span class="o">==</span><span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">){</span>
    <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="dl">"</span><span class="s2">worker.js</span><span class="dl">"</span><span class="p">);}</span>
  <span class="nx">worker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">).</span><span class="nx">innerHTML</span><span class="o">=</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">).</span><span class="nx">innerHTML</span><span class="o">=</span><span class="dl">"</span><span class="s2">Sorry, your browser does not support Web Workers...</span><span class="dl">"</span><span class="p">;}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">stopWorker</span><span class="p">(){</span>
  <span class="nx">worker</span><span class="p">.</span><span class="nx">terminate</span><span class="p">();</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>ä¸‹é¢æ˜¯ worker.js çš„ä»£ç ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">timedCount</span><span class="p">(){</span>
  <span class="nx">i</span><span class="o">=</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
  <span class="nx">postMessage</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="dl">"</span><span class="s2">timedCount()</span><span class="dl">"</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">timedCount</span><span class="p">();</span>
</code></pre></div></div>

<p>å…¶ä¸­ï¼Œæ¶ˆæ¯å†…å®¹æ˜¯ä»»ä½•èƒ½å¤Ÿè¢«åºåˆ—åŒ–çš„å€¼ã€‚</p>

<h3 id="ç»ˆæ­¢-worker">ç»ˆæ­¢ worker</h3>

<p>ä»ä¸»çº¿ç¨‹ä¸­ç«‹å³ç»ˆæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„ workerï¼Œå¯ä»¥è°ƒç”¨ worker çš„ terminate æ–¹æ³•ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">worker</span><span class="p">.</span><span class="nx">terminate</span><span class="p">();</span>
</code></pre></div></div>

<p>åœ¨ worker çº¿ç¨‹å†…éƒ¨ï¼Œworkers æœ‰å¯ä»¥é€šè¿‡è‡ªå·±çš„ close() æ–¹æ³•è¿›è¡Œå…³é—­ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">self</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></div></div>

<blockquote>
  <p>self æŒ‡å‘ worker æœ¬èº«ã€‚</p>
</blockquote>

<h3 id="å¼•å…¥-subworker">å¼•å…¥ subworker</h3>

<p>worker çš„å…¨å±€ä½œç”¨åŸŸæä¾›ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">importScripts()</code>ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ª JavaScript æ–‡ä»¶ï¼Œæ¯ä¸ªåŠ è½½è¿‡ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ‰§è¡Œé¡ºåºä¼šæŒ‰ç…§å…ˆåæ‰§è¡Œã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">importScripts</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">bar.js</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›è„šæœ¬æ˜¯åœ¨ worker çš„å…¨å±€ä½œç”¨åŸŸä¸­è¿è¡Œã€‚</p>

<h3 id="worker-çš„å…¨å±€ä½œç”¨åŸŸ">worker çš„å…¨å±€ä½œç”¨åŸŸ</h3>

<p>Web worker æ‰€æ‰§è¡Œçš„ä»£ç å’Œå½“å‰é¡µé¢çš„ä»£ç ä¸å…±äº«ä½œç”¨åŸŸã€‚æ‰€ä»¥ï¼ŒWeb worker çš„ä»£ç ä¸èƒ½è®¿é—® DOMï¼Œä¹Ÿæ— æ³•é€šè¿‡ä»»ä½•çš„æ–¹å¼å½±å“é¡µé¢çš„å¤–è§‚ã€‚</p>

<p>Web worker ä¸­çš„å…¨å±€å¯¹è±¡å°±æ˜¯ <code class="language-plaintext highlighter-rouge">workder</code> æœ¬èº«ã€‚</p>

<hr />

<h2 id="shared-workers">Shared workers</h2>

<p>Shared worker æœ‰è‡ªå·±çš„å…¨å±€ä½œç”¨åŸŸ SharedWorkerGlobalScopeã€‚</p>

<h3 id="ç”Ÿæˆä¸€ä¸ª-shared-worker">ç”Ÿæˆä¸€ä¸ª Shared worker</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">sharedWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SharedWorker</span><span class="p">(</span><span class="dl">'</span><span class="s1">sharedWorker.js</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>å’Œ Dedicated worker ä¸€ä¸ªéå¸¸å¤§çš„åŒºåˆ«ï¼Œ<strong>ä¸ shared workeré€šä¿¡å¿…é¡»é€šè¿‡ port å¯¹è±¡</strong>ã€‚ä¼ é€’æ¶ˆæ¯å‰ï¼Œç«¯å£å¿…é¡»è¢«æ˜¾å¼æ‰“å¼€ï¼Œæ‰“å¼€æ–¹å¼æ˜¯ä½¿ç”¨ onmessage äº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€… start() æ–¹æ³•ã€‚start() æ–¹æ³•çš„è°ƒç”¨åªåœ¨ä¸€ç§æƒ…å†µä¸‹éœ€è¦ï¼Œé‚£å°±æ˜¯æ¶ˆæ¯äº‹ä»¶è¢« addEventListener() æ–¹æ³•ä½¿ç”¨ã€‚</p>

<p>å¦‚æœä½¿ç”¨ start() æ–¹æ³•æ‰“å¼€ç«¯å£è¿æ¥æ—¶ï¼Œå¦‚æœçˆ¶çº§çº¿ç¨‹å’Œ worker çº¿ç¨‹éœ€è¦åŒå‘é€šä¿¡ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½éœ€è¦è°ƒç”¨ start() æ–¹æ³•ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sharedWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span> <span class="c1">// çˆ¶çº§çº¿ç¨‹ä¸­çš„è°ƒç”¨</span>

<span class="nx">port</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span> <span class="c1">// worker çº¿ç¨‹ä¸­çš„è°ƒç”¨</span>
</code></pre></div></div>

<h3 id="å…±äº«-worker-ä¸­æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€">å…±äº« worker ä¸­æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€</h3>

<p>postMessage() æ–¹æ³•å¿…é¡»è¢«ç«¯å£å¯¹è±¡è°ƒç”¨ã€‚å…¶ä»–éƒ½å’Œ Dedicated worker ä¸€è‡´ã€‚</p>

<h3 id="ä¾‹å­">ä¾‹å­</h3>

<p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªé¡µé¢ <code class="language-plaintext highlighter-rouge">index.html</code> å’Œ <code class="language-plaintext highlighter-rouge">index2.html</code> åˆ†åˆ«æ˜¯è®¡ç®—æ™®é€šä¹˜æ³•å’Œå¹³æ–¹çš„é¡µé¢ã€‚</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--index.html è®¡ç®—æ™®é€šä¹˜æ³•--&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Shared Woker<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"controls"</span> <span class="na">tabindex=</span><span class="s">"0"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">""</span> <span class="na">action=</span><span class="s">"index.html"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"number1"</span><span class="nt">&gt;</span>ä¹˜æ•°1ï¼š<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">""</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">id=</span><span class="s">"number1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">""</span><span class="nt">&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"number2"</span><span class="nt">&gt;</span>ä¹˜æ•°2ï¼š<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">""</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">id=</span><span class="s">"number2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"result1"</span><span class="nt">&gt;</span>ç»“æœæ˜¯ï¼š0<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"./index2.html"</span> <span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>Go to another page<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./multiply.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--index2.html è®¡ç®—å¹³æ–¹--&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Shared Woker<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"controls"</span> <span class="na">tabindex=</span><span class="s">"1"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">""</span> <span class="na">action=</span><span class="s">"index.html"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"number3"</span><span class="nt">&gt;</span>æ•°å­—3ï¼š<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">""</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">id=</span><span class="s">"number3"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"result2"</span><span class="nt">&gt;</span>Result: 0<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./square.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">multiply.js</code> å¦‚ä¸‹:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#number1</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">second</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#number2</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">result1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.result1</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!!</span><span class="nb">window</span><span class="p">.</span><span class="nx">SharedWorker</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SharedWorker</span><span class="p">(</span><span class="dl">"</span><span class="s2">./worker.js</span><span class="dl">"</span><span class="p">);</span>

  <span class="nx">first</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="nx">myWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">([</span><span class="nx">first</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">second</span><span class="p">.</span><span class="nx">value</span><span class="p">]);</span>
  <span class="p">};</span>
  <span class="nx">second</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="nx">myWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">([</span><span class="nx">first</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">second</span><span class="p">.</span><span class="nx">value</span><span class="p">]);</span>
  <span class="p">};</span>
  <span class="nx">myWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">result1</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">square.js</code> å¦‚ä¸‹:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">squreNumber</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#number3</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">result2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.result2</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!!</span><span class="nb">window</span><span class="p">.</span><span class="nx">SharedWorker</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SharedWorker</span><span class="p">(</span><span class="dl">"</span><span class="s2">./worker.js</span><span class="dl">"</span><span class="p">);</span>

  <span class="nx">squreNumber</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">myWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">([</span><span class="nx">squreNumber</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span><span class="nx">squreNumber</span><span class="p">.</span><span class="nx">value</span><span class="p">]);</span>
  <span class="p">};</span>
  <span class="nx">myWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result2</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸¤ä¸ªé¡µé¢ï¼Œå…±äº«åŒä¸€ä¸ª workerï¼Œä»£ç å¦‚ä¸‹:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">onconnect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ports</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

  <span class="nx">port</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">workResult</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Result: </span><span class="dl">"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">workResult</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å‚è€ƒ: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers#Shared_workers">Using Web Workers</a></p>

<hr />

<h2 id="service-workers">Service workers</h2>

<p>è™½ç„¶ Service worker å®šä¹‰ä¸º web workerï¼Œä½†å·²ç»ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ worker äº†ã€‚å‰è€…å¦‚ Dedicated worker å’Œ Shared worker ä¸»è¦æ˜¯è¿›è¡Œ<strong>å¹¶è¡Œè®¡ç®—</strong>ï¼Œè§£å†³<strong>è€—æ—¶çš„ JS æ‰§è¡Œå½±å“ UI å“åº”</strong>çš„é—®é¢˜ã€‚è€Œ Service worker ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ Web app çš„ç”¨æˆ·ä½“éªŒä¸å¦‚ Native app çš„æ™®éé—®é¢˜è€Œæä¾›çš„ä¸€ç³»åˆ—çš„æŠ€æœ¯çš„é›†åˆã€‚</p>

<blockquote>
  <p>Service worker æœ‰ç‚¹åƒ Shared workerï¼Œä½†æ˜¯ Service worker æ§åˆ¶å¤šä¸ªé¡µé¢ï¼Œè€Œä¸æ˜¯é¡µé¢æ§åˆ¶ Shared workerã€‚ â€“ ã€ŠService Worker - first draft publishedã€‹</p>
</blockquote>

<blockquote>
  <p>Service worker å……å½“ Web appã€æµè§ˆå™¨å’Œç½‘ç»œä»£ç†æœåŠ¡å™¨çš„è§’è‰²ã€‚åŸºäºç½‘ç»œæ˜¯å¦å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œæä¾›è‰¯å¥½çš„ç¦»çº¿ä½“éªŒã€æ‹¦æˆªç½‘ç»œè¯·æ±‚å’Œé‡‡å–åˆé€‚çš„è¡Œä¸ºã€‚ â€“ MDN</p>
</blockquote>

<p>æœ‰å…³ Service worker å¯å‚è€ƒçš„å†…å®¹:</p>

<ul>
  <li><a href="https://jakearchibald.com/2014/service-worker-first-draft/">Service Worker - first draft published</a></li>
  <li><a href="https://w3c.github.io/ServiceWorker/">Service Workers Nightly</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/27264234">æ·±å…¥äº†è§£ Service Workerï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></li>
  <li><a href="https://developer.mozilla.org/en/docs/Web/API/Service_Worker_API">Service Worker API</a></li>
  <li><a href="https://www.youtube.com/watch?v=4uQMl7mFB6g&amp;feature=youtu.be">The ServiceWorker: The network layer is yours to own</a></li>
</ul>
:ET