I"-µ<ul id="markdown-toc">
  <li><a href="#connect" id="markdown-toc-connect">Connect</a></li>
  <li><a href="#å®‰è£…connect" id="markdown-toc-å®‰è£…connect">å®‰è£…Connect</a>    <ul>
      <li><a href="#ä¸­é—´ä»¶--middleware" id="markdown-toc-ä¸­é—´ä»¶--middleware">ä¸­é—´ä»¶ â€“ Middleware</a>        <ul>
          <li><a href="#æŒ‚è½½ä¸­é—´ä»¶--mount-middleware" id="markdown-toc-æŒ‚è½½ä¸­é—´ä»¶--mount-middleware">æŒ‚è½½ä¸­é—´ä»¶ â€“ Mount middleware</a></li>
          <li><a href="#å·®é”™ä¸­é—´ä»¶--error-middleware" id="markdown-toc-å·®é”™ä¸­é—´ä»¶--error-middleware">å·®é”™ä¸­é—´ä»¶ â€“ Error middleware</a></li>
        </ul>
      </li>
      <li><a href="#å¯é…ç½®çš„ä¸­é—´ä»¶" id="markdown-toc-å¯é…ç½®çš„ä¸­é—´ä»¶">å¯é…ç½®çš„ä¸­é—´ä»¶</a></li>
      <li><a href="#å·²ç»ä¸æ˜¯connectè‡ªå¸¦çš„ä¸­é—´ä»¶" id="markdown-toc-å·²ç»ä¸æ˜¯connectè‡ªå¸¦çš„ä¸­é—´ä»¶">å·²ç»ä¸æ˜¯Connectè‡ªå¸¦çš„ä¸­é—´ä»¶</a></li>
    </ul>
  </li>
  <li><a href="#express" id="markdown-toc-express">Express</a>    <ul>
      <li><a href="#ä½¿ç”¨express-application-generatorç”Ÿæˆç¨‹åºéª¨æ¶" id="markdown-toc-ä½¿ç”¨express-application-generatorç”Ÿæˆç¨‹åºéª¨æ¶">ä½¿ç”¨Express application generatorç”Ÿæˆç¨‹åºéª¨æ¶</a></li>
      <li><a href="#è·¯ç”±" id="markdown-toc-è·¯ç”±">è·¯ç”±</a>        <ul>
          <li><a href="#route-methods" id="markdown-toc-route-methods">Route methods</a></li>
          <li><a href="#route-paths" id="markdown-toc-route-paths">Route paths</a></li>
          <li><a href="#route-handlers" id="markdown-toc-route-handlers">Route handlers</a></li>
          <li><a href="#approute" id="markdown-toc-approute">app.route()</a></li>
          <li><a href="#expressrouter" id="markdown-toc-expressrouter">express.Router</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#é‡åˆ°çš„bug" id="markdown-toc-é‡åˆ°çš„bug">é‡åˆ°çš„Bug</a>    <ul>
      <li><a href="#refusing-to-install-xxx-as-a-dependency-of-itself" id="markdown-toc-refusing-to-install-xxx-as-a-dependency-of-itself">Refusing to install xxx as a dependency of itself</a></li>
      <li><a href="#å¦‚ä½•ä½¿ç”¨expresså‘½ä»¤è¡Œå·¥å…·" id="markdown-toc-å¦‚ä½•ä½¿ç”¨expresså‘½ä»¤è¡Œå·¥å…·">å¦‚ä½•ä½¿ç”¨Expresså‘½ä»¤è¡Œå·¥å…·</a></li>
      <li><a href="#error-cant-set-headers-after-they-are-sent-to-the-client" id="markdown-toc-error-cant-set-headers-after-they-are-sent-to-the-client">Error: Canâ€™t set headers after they are sent to the client</a></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Connect is an extensible HTTP server framework for node using â€œpluginsâ€ known as middleware.</p>
</blockquote>

<p>è¿™æ˜¯å¼•è‡ªConnect<a href="https://github.com/senchalabs/connect">å®˜æ–¹ä»“åº“</a>çš„ä¸€æ®µæ–‡å­—ï¼Œå¯ä»¥çœ‹åˆ°ï¼šConnectæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯æ¡†æ¶ã€‚åœ¨Connnectä¸­ï¼Œä¸­é—´ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ‹¦æˆª<code class="language-plaintext highlighter-rouge">HTTP</code>æœåŠ¡å™¨æä¾›çš„è¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼Œæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œç„¶åç»“æŸå“åº”æˆ–è€…æŠŠå¥¹ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ç»„ä»¶ã€‚
<br />
<a href="http://expressjs.com/">Express</a>ä¹Ÿæ˜¯ä¸€ä¸ªWebæ¡†æ¶ï¼Œå®˜æ–¹æ˜¯è¿™æ ·ä»‹ç»çš„ï¼š</p>

<blockquote>
  <p>Fast, unopinionated, minimalist web framework for Node.js.</p>
</blockquote>

<p>å‰æœŸç‰ˆæœ¬ä¸­ï¼ŒExpressæ¡†æ¶æ˜¯æ„å»ºåœ¨Connectä¹‹ä¸Šï¼Œä½†æ˜¯åœ¨æœ€æ–°çš„<code class="language-plaintext highlighter-rouge">4.x</code>ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬<a href="http://expressjs.com/en/guide/migrating-4.html">å¼•è¿°äº†ä¸‹é¢è¿™æ®µè¯</a>ï¼š</p>

<blockquote>
  <p>Express 4 no longer depends on Connect, and removes all built-in middleware from its core, except for the express.static function. This means that Express is now an independent routing and middleware web framework, and Express versioning and releases are not affected by middleware updates.</p>
</blockquote>

<p>ä½†æ˜¯ï¼Œå¯¹Connectçš„ä»‹ç»ä»å¯¹æˆ‘ä»¬ç†è§£Expresså¾ˆæœ‰å¸®åŠ©ã€‚</p>

<!-- more -->

<h2 id="connect">Connect</h2>

<p>ä¸¤ä¸ªHTTPè¯·æ±‚ç©¿è¿‡ConnectæœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾ã€‚</p>

<p><img src="/styles/images/node/connect.png" alt="ä¸¤ä¸ªHTTPè¯·æ±‚ç©¿è¿‡ConnectæœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸ" /></p>

<h2 id="å®‰è£…connect">å®‰è£…Connect</h2>

<p>Connectæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½å®‰è£…ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install </span>connect
</code></pre></div></div>

<p>åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ€å°çš„Connectç¨‹åºã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="ä¸­é—´ä»¶--middleware">ä¸­é—´ä»¶ â€“ Middleware</h3>

<p>Connectçš„æ ¸å¿ƒå°±æ˜¯ä¸­é—´ä»¶ã€‚åœ¨Connectä¸­ï¼Œä¸­é—´ä»¶ç»„ä»¶æ˜¯ä¸€ä¸ªJavaScriptå‡½æ•°ï¼ŒæŒ‰æƒ¯ä¾‹ä¼šæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">req</code>ã€<code class="language-plaintext highlighter-rouge">res</code>ã€<code class="language-plaintext highlighter-rouge">next</code>ã€‚è¿™æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œ<code class="language-plaintext highlighter-rouge">next</code>å‚æ•°æ˜¯ä¸å¿…è¦çš„ã€‚ç±»ä¼¼è¿™ç§:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="nx">middleware1</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// middleware 1</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="nx">middleware2</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// middleware 2</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>é‚£ä¹ˆå¦‚ä½•æŒ‚è½½ä¸­é—´ä»¶å‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨<code class="language-plaintext highlighter-rouge">.use()</code>å‡½æ•°ã€‚</p>

<h4 id="æŒ‚è½½ä¸­é—´ä»¶--mount-middleware">æŒ‚è½½ä¸­é—´ä»¶ â€“ Mount middleware</h4>

<p>ä½¿ç”¨æŒ‚è½½ä¸­é—´ä»¶ï¼Œä½ å¯ä»¥åœ¨<code class="language-plaintext highlighter-rouge">.use()</code>å‡½æ•°ä¸­æ¥å—ä¸€ä¸ª<strong>è·¯å¾„å‰ç¼€</strong>ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/foo</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">fooMiddleware</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// req.url starts with "/foo"</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/bar</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">barMiddleware</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// req.url starts with "/bar"</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ä¹Ÿæ˜¯è¯´ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªä¸­é—´ä»¶æˆ‘ä»¬å°†å®ƒæŒ‚è½½åœ¨<code class="language-plaintext highlighter-rouge">/foo</code>è·¯å¾„ä¸Šï¼Œä»£ç ä¸­<code class="language-plaintext highlighter-rouge">/xxx/xxx</code>çš„<code class="language-plaintext highlighter-rouge">req.url</code>é€šè¿‡æµè§ˆå™¨è®¿é—®å°±æ˜¯<code class="language-plaintext highlighter-rouge">/foo/xxx/xxx</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®©æˆ‘ä»¬é‡ç”¨ä»£ç ã€‚</p>

<h4 id="å·®é”™ä¸­é—´ä»¶--error-middleware">å·®é”™ä¸­é—´ä»¶ â€“ Error middleware</h4>

<p>Connectä¸­ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„<code class="language-plaintext highlighter-rouge">Error middleware</code>æ¥å¤„ç†ç¨‹åºé”™è¯¯ã€‚å®ƒæ¥å—å››ä¸ªå‚æ•°: <code class="language-plaintext highlighter-rouge">err</code>ã€<code class="language-plaintext highlighter-rouge">req</code>ã€<code class="language-plaintext highlighter-rouge">res</code>ã€<code class="language-plaintext highlighter-rouge">next</code>ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// regular middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// i had an error</span>
  <span class="nx">next</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">boom!</span><span class="dl">'</span><span class="p">));</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">next</span><span class="p">();</span>   <span class="c1">//skipped</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="nx">onerror</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// an error occurred!</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ç¬¬ä¸€ä¸ªä¸­é—´ä»¶æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œè€Œç¬¬äºŒä¸ªä¸­é—´ä»¶ä»å®ƒçš„è¡¨ç°çœ‹æ¥å¹¶ä¸é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼Œæ‰€ä»¥å®ƒä¼š<code class="language-plaintext highlighter-rouge">skipped</code>ç›´åˆ°<code class="language-plaintext highlighter-rouge">Connect</code>çœ‹åˆ°ä¸€ä¸ªå·®é”™å¤„ç†ä¸­é—´ä»¶ã€‚</p>

<h3 id="å¯é…ç½®çš„ä¸­é—´ä»¶">å¯é…ç½®çš„ä¸­é—´ä»¶</h3>

<p>åˆ›å»ºæ›´é€šç”¨çš„ã€å¯é‡ç”¨çš„ä¸­é—´ä»¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚ä¸ºæ­¤ï¼Œä¸­é—´ä»¶é€šå¸¸ä¼šéµå¾ªä¸€ä¸ªç®€å•çš„æƒ¯ä¾‹: ç”¨å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°(ä¹Ÿå°±æ˜¯é—­åŒ…)ã€‚ç»“æ„ç±»ä¼¼è¿™ç§:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">setup</span> <span class="p">(</span><span class="nx">options</span><span class="p">){</span>
    <span class="c1">//è®¾ç½®é€»è¾‘</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">,</span><span class="nx">next</span><span class="p">){</span>
        <span class="c1">//ä¸­é—´ä»¶é€»è¾‘</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ç§ä¸­é—´ä»¶çš„ç”¨æ³•å¦‚ä¸‹:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="p">(</span><span class="nx">setup</span><span class="p">({</span><span class="na">some</span><span class="p">:</span><span class="dl">'</span><span class="s1">options</span><span class="dl">'</span><span class="p">}))</span>
</code></pre></div></div>

<h3 id="å·²ç»ä¸æ˜¯connectè‡ªå¸¦çš„ä¸­é—´ä»¶">å·²ç»ä¸æ˜¯Connectè‡ªå¸¦çš„ä¸­é—´ä»¶</h3>

<p>åœ¨æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œä»¥å‰æ˜¯Connectå†…ç½®çš„ä¸­é—´ä»¶éƒ½è¢«ç§»é™¤äº†ã€‚Express 4.xä¹Ÿç§»é™¤äº†è‡ªå¸¦çš„ä¸­é—´ä»¶(æ‰€ä»¥è¯´ï¼ŒExpress 4.xå·²ä¸å†ä¾èµ–Connectäº†)ï¼Œé™¤äº†<code class="language-plaintext highlighter-rouge">express.static</code>å‡½æ•°ï¼Œå¹¶å¯¹å…¶ä¸­ä¸€äº›å‘½åè¿›è¡Œäº†æ›´æ–°ã€‚ä»¥ä¸‹çš„ä¸­é—´ä»¶è¢«Connectå’ŒExpressåŒæ—¶å®˜æ–¹æ”¯æŒï¼Œä¸”å·²æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</p>

<ul>
  <li><a href="https://www.npmjs.com/package/body-parser">body-parser</a> â€“ è§£æè¯·æ±‚ä½“</li>
  <li><a href="https://www.npmjs.com/package/compression">compression</a> â€“ Node.jså‹ç¼©ä¸­é—´ä»¶</li>
  <li><a href="https://www.npmjs.com/package/connect-timeout">connect-timeout</a> â€“ åœ¨Connect/Expressåº”ç”¨æ¡†æ¶ä¸­å°†è¯·æ±‚è¶…æ—¶</li>
  <li><a href="https://www.npmjs.com/package/cookie-parser">cookie-parser</a> â€“ è§£æcookie</li>
  <li><a href="https://www.npmjs.com/package/csurf">csurf</a> â€“ Node.js CSRFä¿æŠ¤ä¸­é—´ä»¶</li>
  <li><a href="https://www.npmjs.com/package/errorhandler">errorhandler</a> â€“ ä»…åœ¨å¼€å‘æœŸé—´çš„å·®é”™æ§åˆ¶ä¸­é—´ä»¶</li>
  <li><a href="https://www.npmjs.com/package/express-session">express-session</a></li>
  <li><a href="https://www.npmjs.com/package/method-override">method-override</a> â€“ å½“ä½ çš„å®¢æˆ·ç«¯ä¸æ”¯æŒHTTPè°“è¯çš„æ—¶å€™ä½ å¯ä»¥ä½¿ç”¨å®ƒ</li>
  <li><a href="https://www.npmjs.com/package/morgan">morgan</a> â€“ è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶</li>
  <li><a href="https://www.npmjs.com/package/response-time">response-time</a></li>
  <li><a href="https://www.npmjs.com/package/serve-favicon">serve-favicon</a> â€“ æä¾›faviconçš„ä¸­é—´ä»¶</li>
  <li><a href="https://www.npmjs.com/package/serve-index">serve-index</a> â€“ æä¾›åŒ…å«ç»™å®šè·¯å¾„çš„é¡µé¢</li>
  <li><a href="https://www.npmjs.com/package/serve-static">server-static</a></li>
  <li><a href="https://www.npmjs.com/package/vhost">vhost</a></li>
</ul>

<blockquote>
  <p>å¯ä»¥å‚è€ƒ: <a href="https://github.com/senchalabs/connect#middleware">https://github.com/senchalabs/connect#middleware</a></p>
</blockquote>

<hr />

<h2 id="express">Express</h2>

<p>Expressä¹Ÿæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæ‰€ä»¥å…¨å±€æˆ–é¡¹ç›®ä¾èµ–å®‰è£…ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install </span>express <span class="nt">--save</span>
</code></pre></div></div>

<p>åœ¨ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code class="language-plaintext highlighter-rouge">app.js</code>(æˆ–è€…<code class="language-plaintext highlighter-rouge">index.js</code>)ä½œä¸ºå…¥å£æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„<code class="language-plaintext highlighter-rouge">hello world</code>ç¨‹åºã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//app.js</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Example app listening on port 3000!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ä½¿ç”¨<code class="language-plaintext highlighter-rouge">$ node app.js</code>è¿è¡Œè¿™ä¸ªåº”ç”¨ã€‚é‚£ä¹ˆï¼Œå®ƒä¼šå¼€å¯æœåŠ¡å™¨ï¼Œå¹¶åœ¨<code class="language-plaintext highlighter-rouge">3000</code>ç«¯å£è¿›è¡Œç›‘å¬ã€‚å½“æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨è®¿é—®<code class="language-plaintext highlighter-rouge">http://localhost:3000</code>åœ°å€å‘é€<code class="language-plaintext highlighter-rouge">GET</code>è¯·æ±‚ï¼Œåº”ç”¨å°±ä¼šå“åº”<code class="language-plaintext highlighter-rouge">Hello World</code>ã€‚</p>

<h3 id="ä½¿ç”¨express-application-generatorç”Ÿæˆç¨‹åºéª¨æ¶">ä½¿ç”¨Express application generatorç”Ÿæˆç¨‹åºéª¨æ¶</h3>

<p>åœ¨<code class="language-plaintext highlighter-rouge">4.x</code>ç‰ˆæœ¬ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">express-generator</code>ä»expressä¸­ç‹¬ç«‹å‡ºæ¥ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯expressçš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ¨¡å—è¿›è¡Œå…¨å±€å®‰è£…ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install </span>express-generator <span class="nt">-g</span>
</code></pre></div></div>

<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Î» express <span class="nt">--view</span><span class="o">=</span>pug myblog

   create : myblog
   create : myblog/package.json
   create : myblog/app.js
   create : myblog/public
   create : myblog/routes
   create : myblog/routes/index.js
   create : myblog/routes/users.js
   create : myblog/views
   create : myblog/views/index.pug
   create : myblog/views/layout.pug
   create : myblog/views/error.pug
   create : myblog/bin
   create : myblog/bin/www
   create : myblog/public/images
   create : myblog/public/javascripts
   create : myblog/public/stylesheets
   create : myblog/public/stylesheets/style.css

   <span class="nb">install </span>dependencies:
     <span class="o">&gt;</span> <span class="nb">cd </span>myblog <span class="o">&amp;&amp;</span> npm <span class="nb">install

   </span>run the app:
     <span class="o">&gt;</span> SET <span class="nv">DEBUG</span><span class="o">=</span>myblog:<span class="k">*</span> &amp; npm start
</code></pre></div></div>

<blockquote>
  <p>Expressè¿˜æ”¯æŒ<code class="language-plaintext highlighter-rouge">jade</code>ã€<code class="language-plaintext highlighter-rouge">ejs</code>ç­‰å¤šç§æ¨¡æ¿å¼•æ“ã€‚å…¶ä¸­ï¼Œé»˜è®¤ä¸º<code class="language-plaintext highlighter-rouge">jade</code>ã€‚å› ä¸ºç‰ˆæƒä¹‹äº‰ï¼Œ<code class="language-plaintext highlighter-rouge">jade</code>æ›´åä¸º<code class="language-plaintext highlighter-rouge">Pug</code>ï¼Œæˆ‘çš„çŒœæµ‹æ˜¯ï¼ŒExpressçš„é»˜è®¤æ¨¡æ¿å¼•æ“ä¹Ÿä¼šæ›´æ”¹ä¸º<code class="language-plaintext highlighter-rouge">Pug</code>ã€‚</p>
</blockquote>

<p>å‘½ä»¤ä¸­æˆ‘ä»¬ä½¿ç”¨<a href="https://pugjs.org/api/getting-started.html"><code class="language-plaintext highlighter-rouge">pug</code></a>ä½œä¸ºæˆ‘ä»¬çš„æ¨¡æ¿å¼•æ“ï¼Œåˆ›å»º<code class="language-plaintext highlighter-rouge">myblog</code>é¡¹ç›®ã€‚ç»“æ„å¦‚ä¸‹:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">â”‚</span>  <span class="nx">app</span><span class="p">.</span><span class="nx">js</span>
<span class="err">â”‚</span>  <span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€</span><span class="nx">bin</span>
<span class="err">â”‚</span>      <span class="nx">www</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€</span><span class="kr">public</span>
<span class="err">â”‚</span>  <span class="err">â”œâ”€</span><span class="nx">images</span>
<span class="err">â”‚</span>  <span class="err">â”œâ”€</span><span class="nx">javascripts</span>
<span class="err">â”‚</span>  <span class="err">â””â”€</span><span class="nx">stylesheets</span>
<span class="err">â”‚</span>          <span class="nx">style</span><span class="p">.</span><span class="nx">css</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€</span><span class="nx">routes</span>
<span class="err">â”‚</span>      <span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="err">â”‚</span>      <span class="nx">users</span><span class="p">.</span><span class="nx">js</span>
<span class="err">â”‚</span>
<span class="err">â””â”€</span><span class="nx">views</span>
        <span class="nx">error</span><span class="p">.</span><span class="nx">pug</span>
        <span class="nx">index</span><span class="p">.</span><span class="nx">pug</span>
        <span class="nx">layout</span><span class="p">.</span><span class="nx">pug</span>
</code></pre></div></div>

<p>æ‰“å¼€<code class="language-plaintext highlighter-rouge">package.json</code>ä¼šå‘ç°ï¼Œå…¥å£æ–‡ä»¶æ˜¯<code class="language-plaintext highlighter-rouge">./bin/www</code>ï¼Œè€Œä¸”åŒ…å«ä¼—å¤šä¾èµ–é¡¹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨<code class="language-plaintext highlighter-rouge">npm install</code>å®‰è£…ä¾èµ–é¡¹ï¼Œç„¶åè¿è¡Œè¿™ä¸ªåº”ç”¨ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Î» npm <span class="nb">install
</span>Î» SET <span class="nv">DEBUG</span><span class="o">=</span>myblog:<span class="k">*</span> &amp; npm start
</code></pre></div></div>

<p>æ­¤æ—¶ï¼Œåº”ç”¨å·²ç»ç›‘å¬åœ¨<code class="language-plaintext highlighter-rouge">3000</code>ç«¯å£ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨<code class="language-plaintext highlighter-rouge">http://localhost:3000</code>è®¿é—®ã€‚</p>

<p>å¤‡æ³¨ï¼š<code class="language-plaintext highlighter-rouge">SET DEBUG=myblog:*</code>æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹<code class="language-plaintext highlighter-rouge">app.js</code>ä¸­çš„å†…å®¹ï¼Œå¦‚ä¸‹:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//app.js</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>             <span class="c1">//Nodeè‡ªå¸¦çš„æ¨¡å—</span>
<span class="kd">var</span> <span class="nx">favicon</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">serve-favicon</span><span class="dl">'</span><span class="p">);</span> <span class="c1">//Node.jsæä¾›å›¾æ ‡çš„ä¸­é—´ä»¶</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">morgan</span><span class="dl">'</span><span class="p">);</span>         <span class="c1">//Node.jsæä¾›HTTPè¯·æ±‚loggerçš„ä¸­é—´ä»¶</span>
<span class="kd">var</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cookie-parser</span><span class="dl">'</span><span class="p">);</span><span class="c1">//è§£æCookie headerçš„ä¸­é—´ä»¶</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">body-parser</span><span class="dl">'</span><span class="p">);</span><span class="c1">//è§£æè¯·æ±‚ä½“çš„ä¸­é—´ä»¶</span>

<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./routes/index</span><span class="dl">'</span><span class="p">);</span>  <span class="c1">//é»˜è®¤çš„è·¯ç”±ï¼Œå’Œapp.use('/', index)å…³è”</span>
<span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./routes/users</span><span class="dl">'</span><span class="p">);</span>  <span class="c1">//é»˜è®¤çš„è·¯ç”±ï¼Œå’Œapp.use('/users', users)å…³è”</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>                    <span class="c1">//ç”Ÿæˆexpresså®ä¾‹</span>

<span class="c1">// view engine setupï¼Œæ¨¡æ¿å¼•æ“è®¾ç½®</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">));</span><span class="c1">//__dirnameè¡¨ç¤ºç›®å½•æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ï¼Œä»¥æˆ‘çš„ä¸ºä¾‹æ˜¯ï¼ŒC:\Users\timi\node-vscode\inaction\express-test\myblog</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">view engine</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">pug</span><span class="dl">'</span><span class="p">);</span>  <span class="c1">//ä½¿ç”¨Pugä½œä¸ºæ¨¡æ¿å¼•æ“</span>

<span class="c1">// uncomment after placing your favicon in /public</span>
<span class="c1">//app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));  //è®¾ç½®favicon.icoå›¾æ ‡ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå–æ¶ˆè¿™å¥çš„æ³¨é‡Š</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">(</span><span class="dl">'</span><span class="s1">dev</span><span class="dl">'</span><span class="p">));</span>                 <span class="c1">//æ—¥å¿—æ˜¾ç¤ºï¼Œå¯æ›¿æ¢çš„å‚æ•°æœ‰combinedã€commonã€devã€shortã€tinyã€‚å…·ä½“å‚è§: https://www.npmjs.com/package/morgan</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>             <span class="c1">//åªè§£æjsonå¹¶åªæŸ¥çœ‹Content-Typeæ»¡è¶³typeçš„è¯·æ±‚ã€‚å…·ä½“å‚è§: https://www.npmjs.com/package/body-parser#bodyparserjsonoptions</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}));</span>    <span class="c1">//åªè§£æURL-encoded bodiesã€‚å…·ä½“å‚è§: https://www.npmjs.com/package/body-parser#bodyparserurlencodedoptions</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>    <span class="c1">//cookieè§£æ</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">)));</span>    <span class="c1">//Expresså”¯ä¸€çš„å†…å»ºçš„ä¸­é—´ä»¶ï¼Œç”¨æ¥æä¾›é™æ€æ–‡ä»¶ï¼Œéƒ½æ”¾åœ¨publicæ–‡ä»¶ä¸­ï¼Œå…·ä½“å‚çœ‹Express API</span>

<span class="c1">//è·¯ç”±å¤„ç†</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/users</span><span class="dl">'</span><span class="p">,</span> <span class="nx">users</span><span class="p">);</span>

<span class="c1">// catch 404 and forward to error handler</span>
<span class="c1">//å¦‚æœæ²¡æœ‰é™æ€æ–‡ä»¶ï¼Œæ²¡æœ‰æ‰¾åˆ°è¢«è·¯ç”±å¤„ç†çš„æ–‡ä»¶ï¼Œåˆ™äº¤ç»™å®ƒæ¥å¤„ç†ã€‚</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Not Found</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
  <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// error handler</span>
<span class="c1">//å·®é”™æ§åˆ¶ä¸­é—´ä»¶</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// set locals, only providing error in development</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">env</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span> <span class="p">?</span> <span class="nx">err</span> <span class="p">:</span> <span class="p">{};</span>

  <span class="c1">// render the error page</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="mi">500</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>

</code></pre></div></div>

<p>è¯·å¯¹ç…§æˆ‘ä»¬åœ¨Connectè¿™ä¸€èŠ‚ä¸­çš„ç¬¬ä¸€ä¸ªå›¾ï¼ŒExpressåº”ç”¨ä½¿ç”¨ä¸­é—´ä»¶çš„é¡ºåºå’Œå›¾æ˜¯ä¸€è‡´çš„ã€‚æ¯”å¦‚ï¼Œæµè§ˆå™¨è¯·æ±‚é™æ€æ–‡ä»¶ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œå°†å®ƒä¼ é€’ç»™<code class="language-plaintext highlighter-rouge">favicon</code>ä¸­é—´ä»¶ï¼Œç„¶åäº¤ç”±<code class="language-plaintext highlighter-rouge">logger</code>ä¸­é—´ä»¶ï¼Œå¦‚æœæœ‰ï¼Œè¯·æ±‚ä½“å°±ä¼šè¢«è§£æï¼Œç„¶åç”¨é™æ€æ–‡ä»¶è¿›è¡Œå“åº”ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±äº¤ç”±å·®é”™æ§åˆ¶ä¸­é—´ä»¶ã€‚</p>

<p>ä¸Šé¢è¿™ä¸ªæ–‡ä»¶æ¶µç›–äº†å¤§éƒ¨åˆ†çš„Expressçš„å†…å®¹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ä¸Šé¢çš„å‡ ä¸ªå…³é”®æ¦‚å¿µè¿›è¡Œé˜è¿°ã€‚</p>

<h3 id="è·¯ç”±">è·¯ç”±</h3>

<p>è·¯ç”±æŒ‡çš„æ˜¯ä¸€ä¸ªç”±<code class="language-plaintext highlighter-rouge">URL</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">path</code>å’Œ<code class="language-plaintext highlighter-rouge">HTTP request method</code>ï¼Œç”¨æ¥å“åº”å®¢æˆ·ç«¯å¯¹æŸä¸ªç«™ç‚¹çš„è®¿é—®ã€‚</p>

<blockquote>
  <p>ç®€è€Œè¨€ä¹‹ï¼Œå®ƒä¼šæŠŠè¯·æ±‚URLæ˜ å°„åˆ°å®é™…ä¸šåŠ¡é€»è¾‘çš„å‡½æ•°ä¸Š</p>
</blockquote>

<p>è·¯ç”±å®šä¹‰ç”±å¦‚ä¸‹çš„ç»“æ„:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">METHOD</span><span class="p">(</span><span class="nx">PATH</span><span class="p">,</span> <span class="nx">HANDLER</span><span class="p">)</span>
</code></pre></div></div>

<p>å…¶ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">app</code>æ˜¯<code class="language-plaintext highlighter-rouge">express</code>çš„å®ä¾‹ã€‚<code class="language-plaintext highlighter-rouge">METHOD</code>æ˜¯<code class="language-plaintext highlighter-rouge">HTTP request method(get/post/head/put/delete...)</code>ã€‚<code class="language-plaintext highlighter-rouge">PATH</code>æ˜¯æœåŠ¡å™¨ä¸Šçš„åœ°å€ã€‚<code class="language-plaintext highlighter-rouge">HANDLE</code>æ˜¯è·¯ç”±åŒ¹é…åˆ°æ—¶çš„æ‰§è¡Œå‡½æ•°ï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚</p>

<p>ä¸‹é¢æ—¶ä¸€ä¸ªåŸºæœ¬çš„è·¯ç”±ä¾‹å­:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h4 id="route-methods">Route methods</h4>

<p>Expressæ”¯æŒæ‰€æœ‰çš„<code class="language-plaintext highlighter-rouge">HTTP methods</code>: get, post, put, head, delete, options, trace, copy, lock, mkcol, move, purge, propfind, proppatch, unlock, report, mkactivity, checkout, merge, m-search, notify, subscribe, unsubscribe, patch, search, and connect.</p>

<p>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„Route methodæ˜¯<code class="language-plaintext highlighter-rouge">app.all()</code>ï¼Œç”¨æ¥ä¸ºæ‰€æœ‰çš„<code class="language-plaintext highlighter-rouge">request methods</code>åŠ è½½ä¸­é—´ä»¶ã€‚</p>

<h4 id="route-paths">Route paths</h4>

<p>Route pathså¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²æ¨¡å¼æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>

<h4 id="route-handlers">Route handlers</h4>

<p>Route handlerså¯ä»¥åƒä¸­é—´ä»¶ä¸€æ ·ä½¿ç”¨å¤šä¸ªå›è°ƒå‡½æ•°ã€‚ä¸€ä¸ªä¾‹å¤–æ˜¯è¿™äº›å›è°ƒå‡½æ•°å¯èƒ½ä¼šè°ƒç”¨<code class="language-plaintext highlighter-rouge">next()</code>æ¥è·³è¿‡å‰©ä¸‹çš„è·¯ç”±å›è°ƒå‡½æ•°ã€‚</p>

<p>å“åº”å¯¹è±¡(<code class="language-plaintext highlighter-rouge">res</code>)èƒ½å‘é€å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ç»ˆæ­¢<code class="language-plaintext highlighter-rouge">request-response cycle</code>ã€‚<code class="language-plaintext highlighter-rouge">res</code>å¯¹è±¡çš„æ–¹æ³•æœ‰:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">res.download()</code> : æä¾›å¯ä¾›ä¸‹è½½çš„æ–‡ä»¶</li>
  <li><code class="language-plaintext highlighter-rouge">res.end()</code> : ç»“æŸå“åº”</li>
  <li><code class="language-plaintext highlighter-rouge">res.json()</code> : å‘é€ä¸€ä¸ªJSONå“åº”</li>
  <li><code class="language-plaintext highlighter-rouge">res.jsonp()</code> : å‘é€ä¸€ä¸ªJSONPæ”¯æŒçš„JSONå“åº”</li>
  <li><code class="language-plaintext highlighter-rouge">res.redirect()</code> : é‡å®šå‘ä¸€ä¸ªè¯·æ±‚</li>
  <li><code class="language-plaintext highlighter-rouge">res.render()</code> : æ¸²æŸ“ä¸€ä¸ªæ¨¡æ¿è§†å›¾</li>
  <li><code class="language-plaintext highlighter-rouge">res.send()</code> : å‘é€ä¸€ä¸ªå¤šç±»å‹çš„å“åº”</li>
  <li><code class="language-plaintext highlighter-rouge">res.sendFile()</code> : ä»¥å…«å­—èŠ‚å‘é€ä¸€ä¸ªæ–‡ä»¶</li>
  <li><code class="language-plaintext highlighter-rouge">res.sendStatus()</code> : å‘é€å“åº”çŠ¶æ€å­—</li>
</ul>

<blockquote>
  <p>å¦‚æœä¸Šè¿°æ–¹æ³•æ²¡æœ‰ä¸€ä¸ªè¢«è°ƒç”¨ï¼Œåˆ™å®¢æˆ·ç«¯è¯·æ±‚è¢«æ‚¬æŒ‚ã€‚</p>
</blockquote>

<h4 id="approute">app.route()</h4>

<p>é€šè¿‡<code class="language-plaintext highlighter-rouge">app.route()</code>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>é“¾å¼çš„route handlers</strong>ï¼Œè¿™æ ·å¯ä»¥é¿å…å¾ˆå¤šå†—ä½™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="dl">'</span><span class="s1">/book</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Get a random book</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Add a book</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Update the book</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre></div></div>

<h4 id="expressrouter">express.Router</h4>

<p><code class="language-plaintext highlighter-rouge">express.Router</code>ç±»å¯ä»¥åˆ›å»º<strong>æ¨¡å—åŒ–çš„ï¼Œå¯æŒ‚è½½çš„route handlers</strong>ï¼Œä¸€ä¸ªRouterå®ä¾‹å®Œå…¨å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶å’Œè·¯ç”±ç³»ç»Ÿã€‚</p>

<p>ä¸¾ä¾‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè·¯ç”±æ–‡ä»¶<code class="language-plaintext highlighter-rouge">birds.js</code>ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//birds.js</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">()</span>

<span class="c1">// middleware that is specific to this router</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="nx">timeLog</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Time: </span><span class="dl">'</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">())</span>
  <span class="nx">next</span><span class="p">()</span>
<span class="p">})</span>
<span class="c1">// define the home page route</span>
<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Birds home page</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>
<span class="c1">// define the about route</span>
<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/about</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">About birds</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span>
</code></pre></div></div>

<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸»æ–‡ä»¶<code class="language-plaintext highlighter-rouge">app.js</code>ä¸­åŠ è½½è¿™ä¸ªè·¯ç”±æ¨¡å—ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//app.js</span>
<span class="kd">var</span> <span class="nx">birds</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./birds</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// ...</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/birds</span><span class="dl">'</span><span class="p">,</span> <span class="nx">birds</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™æ ·ï¼ŒæœåŠ¡å™¨å°±èƒ½å“åº”å®¢æˆ·ç«¯çš„<code class="language-plaintext highlighter-rouge">/birds</code>å’Œ<code class="language-plaintext highlighter-rouge">/birds/about</code>ï¼Œå¹¶è°ƒç”¨<code class="language-plaintext highlighter-rouge">timeLog</code>ä¸­é—´ä»¶ã€‚</p>

<hr />

<h2 id="é‡åˆ°çš„bug">é‡åˆ°çš„Bug</h2>

<h3 id="refusing-to-install-xxx-as-a-dependency-of-itself">Refusing to install xxx as a dependency of itself</h3>

<p>åŸå› æ˜¯å®‰è£…çš„ä¾èµ–åŒ…å’Œé¡¹ç›®åç§°æœ‰å†²çªï¼Œå¯ä»¥åœ¨<code class="language-plaintext highlighter-rouge">package.json</code>ä¸­ä¿®æ”¹<code class="language-plaintext highlighter-rouge">name</code>å±æ€§ã€‚</p>

<h3 id="å¦‚ä½•ä½¿ç”¨expresså‘½ä»¤è¡Œå·¥å…·">å¦‚ä½•ä½¿ç”¨Expresså‘½ä»¤è¡Œå·¥å…·</h3>

<p>åœ¨æœ€æ–°çš„<code class="language-plaintext highlighter-rouge">4.x</code>ç‰ˆæœ¬ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">express generator</code>ä»<code class="language-plaintext highlighter-rouge">express core</code>ä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œéœ€è¦å¦å¤–å®‰è£…ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install express-generator
</code></pre></div></div>

<h3 id="error-cant-set-headers-after-they-are-sent-to-the-client">Error: Canâ€™t set headers after they are sent to the client</h3>

<blockquote>
  <p>callback twice was my issue.</p>
</blockquote>

<p>å‚è§<a href="https://stackoverflow.com/questions/7042340/error-cant-set-headers-after-they-are-sent-to-the-client"><code class="language-plaintext highlighter-rouge">stackflow</code></a></p>
:ET