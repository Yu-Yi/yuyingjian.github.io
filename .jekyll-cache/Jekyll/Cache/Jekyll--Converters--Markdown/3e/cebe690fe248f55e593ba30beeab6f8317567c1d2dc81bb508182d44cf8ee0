I"ŠW<ul id="markdown-toc">
  <li><a href="#step-1--å‘å‡ºhttpè¯·æ±‚" id="markdown-toc-step-1--å‘å‡ºhttpè¯·æ±‚">step 1 : å‘å‡ºHTTPè¯·æ±‚</a>    <ul>
      <li><a href="#open" id="markdown-toc-open">open()</a></li>
      <li><a href="#send" id="markdown-toc-send">send()</a></li>
    </ul>
  </li>
  <li><a href="#step-2--å¤„ç†æœåŠ¡å™¨è¯·æ±‚" id="markdown-toc-step-2--å¤„ç†æœåŠ¡å™¨è¯·æ±‚">step 2 : å¤„ç†æœåŠ¡å™¨è¯·æ±‚</a></li>
  <li><a href="#ä½¿ç”¨æ•°æ®" id="markdown-toc-ä½¿ç”¨æ•°æ®">ä½¿ç”¨æ•°æ®</a></li>
  <li><a href="#å–æ¶ˆå¼‚æ­¥è¯·æ±‚" id="markdown-toc-å–æ¶ˆå¼‚æ­¥è¯·æ±‚">å–æ¶ˆå¼‚æ­¥è¯·æ±‚</a></li>
  <li><a href="#example" id="markdown-toc-example">example</a></li>
  <li><a href="#ajax-è·¨åŸŸ" id="markdown-toc-ajax-è·¨åŸŸ">Ajax è·¨åŸŸ</a>    <ul>
      <li><a href="#ç®€å•è¯·æ±‚" id="markdown-toc-ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚</a></li>
      <li><a href="#éç®€å•è¯·æ±‚" id="markdown-toc-éç®€å•è¯·æ±‚">éç®€å•è¯·æ±‚</a></li>
      <li><a href="#jsonp-è·¨åŸŸæŠ€æœ¯" id="markdown-toc-jsonp-è·¨åŸŸæŠ€æœ¯">JSONP è·¨åŸŸæŠ€æœ¯</a></li>
    </ul>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">AJAX</code> stands for <code class="language-plaintext highlighter-rouge">A</code>synchronous <code class="language-plaintext highlighter-rouge">J</code>avaScript and <code class="language-plaintext highlighter-rouge">X</code>ML. å®ƒæ˜¯ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"><code class="language-plaintext highlighter-rouge">XMLHttpRequest</code></a>å¯¹è±¡ä¸æœåŠ¡å™¨ç«¯è„šæœ¬è¿›è¡Œé€šä¿¡ã€‚å®ƒå¯ä»¥å‘é€ä»¥åŠæ¥æ”¶å„ç§æ ¼å¼çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬<code class="language-plaintext highlighter-rouge">JSON</code>ï¼Œ<code class="language-plaintext highlighter-rouge">XML</code>ï¼Œ<code class="language-plaintext highlighter-rouge">HTML</code>ï¼Œç”šè‡³æ–‡æœ¬æ–‡ä»¶ã€‚</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">XMLHttpRequest</code>æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">API</code>, å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡<code class="language-plaintext highlighter-rouge">URL</code>æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚<strong>è¿™ä¸ªå¯¹è±¡å……å½“ç€æµè§ˆå™¨ä¸­çš„è„šæœ¬ï¼ˆå®¢æˆ·ç«¯ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººçš„è§’è‰²</strong>ã€‚ä»¥å¾€çš„è¯·æ±‚éƒ½æ˜¯ç”±æµè§ˆå™¨å‘å‡ºï¼Œè€Œ<code class="language-plaintext highlighter-rouge">JavaScript</code>é€šè¿‡è¿™ä¸ªå¯¹è±¡å¯ä»¥è‡ªå·±å‘é€è¯·æ±‚ï¼ŒåŒæ—¶ä¹Ÿè‡ªå·±å¤„ç†å“åº”ã€‚</p>
</blockquote>

<p>The two major features of <code class="language-plaintext highlighter-rouge">AJAX</code>:</p>

<ul>
  <li>å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè€Œä¸é‡æ–°åŠ è½½é¡µé¢</li>
  <li>æ¥æ”¶å’Œå¤„ç†æœåŠ¡å™¨ä¸­çš„æ•°æ®</li>
</ul>

<!-- more -->

<hr />

<h2 id="step-1--å‘å‡ºhttpè¯·æ±‚">step 1 : å‘å‡ºHTTPè¯·æ±‚</h2>

<p>In order to make an <code class="language-plaintext highlighter-rouge">HTTP</code> request to the server using JavaScript, you need an <strong>instance</strong> of a class that provides this functionality.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Old compatibility code, no longer needed.</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Mozilla, Safari, IE7+ ...</span>
    <span class="nx">httpRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ActiveXObject</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IE 6 and older</span>
    <span class="nx">httpRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="dl">"</span><span class="s2">Microsoft.XMLHTTP</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// new</span>
<span class="kd">const</span> <span class="nx">httpRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</code></pre></div></div>

<p>Next, you need to decide what you want to do after you receive the server response to your request. At this stage, you just need to tell the <code class="language-plaintext highlighter-rouge">HTTP</code> request object which JavaScript function will handle processing the response. This is done by setting the <code class="language-plaintext highlighter-rouge">onreadystatechange</code> property of the object to the name of the JavaScript function that should be called when the state of the request changes:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">nameOfTheFunction</span><span class="p">;</span>
</code></pre></div></div>

<blockquote>
  <p>æ³¨æ„ï¼Œå‡½æ•°ååé¢æ²¡æœ‰æ‹¬å·ï¼Œæ²¡æœ‰å‚æ•°ä¼ é€’ï¼Œå› ä¸ºä½ åªæ˜¯ç»™å‡½æ•°èµ‹äº†ä¸€ä¸ªå¼•ç”¨ï¼Œè€Œä¸æ˜¯å®é™…è°ƒç”¨å®ƒã€‚</p>
</blockquote>

<p>Also, instead of giving a function name, you can use the JavaScript technique of defining functions on the fly (called â€œanonymous functionsâ€(åŒ¿åå‡½æ•°)) and define the actions that will process the response right awayï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// process the server response</span>
<span class="p">};</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">onreadystatechange</code>æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå®ƒä¼šåœ¨æœåŠ¡å™¨ç»™<code class="language-plaintext highlighter-rouge">XMLHttpRequest</code>å¯¹è±¡é€å›å“åº”çš„æ—¶å€™è¢«è§¦å‘ã€‚</p>
</blockquote>

<p>Next, after youâ€™ve declared what will happen as soon as you receive the response, you need to actually make the request(ä¸€æ—¦ä½ ç¡®å®šäº†æ”¶åˆ°å“åº”åä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè¿™ä¸ªæ—¶å€™ä½ æ‰èƒ½æ­£å¼æå‡ºè¯·æ±‚). You need to call the <code class="language-plaintext highlighter-rouge">open()</code> and <code class="language-plaintext highlighter-rouge">send()</code> methods of the HTTP request class:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://www.example.org/some.file</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">httpRequest</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p>æˆ‘ä»¬æœ€å¥½å§‹ç»ˆå°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾å®šæˆ <code class="language-plaintext highlighter-rouge">true</code> ä»¥å¼‚æ­¥çš„æ–¹å¼å‘é€è¯·æ±‚çš„å¸ƒå°”å€¼ã€‚å¦å¤–å¼ºè°ƒçš„æ˜¯ï¼Œè°ƒç”¨ <code class="language-plaintext highlighter-rouge">open()</code> æ–¹æ³•å¹¶ä¸ä¼šçœŸæ­£å‘é€è¯·æ±‚ï¼Œè€Œåªæ˜¯å¯åŠ¨ä¸€ä¸ªè¯·æ±‚ä»¥å¤‡å‘é€ï¼Œæ‰€ä»¥è¿˜éœ€è¦è°ƒç”¨ <code class="language-plaintext highlighter-rouge">send()</code>æ–¹æ³•ã€‚</p>
</blockquote>

<p>å¦‚æœä¸éœ€è¦é€šè¿‡è¯·æ±‚ä¸»ä½“å‘é€æ•°æ®ï¼Œåˆ™å¿…é¡»ä¼ å…¥ nullï¼Œæ¯”å¦‚ä½¿ç”¨ GET æ–¹æ³•ã€‚å¦‚æœä½¿ç”¨ POST æ–¹æ³•ï¼Œéœ€è¦å°†ä¼ é€çš„æ•°æ®åŠ å…¥ã€‚</p>

<h4 id="open">open()</h4>

<ul>
  <li>The first parameter of <code class="language-plaintext highlighter-rouge">open()</code> is the HTTP request method â€“ <code class="language-plaintext highlighter-rouge">GET</code>, <code class="language-plaintext highlighter-rouge">POST</code>, <code class="language-plaintext highlighter-rouge">HEAD</code> or any other method you want to use and that is supported by your server</li>
  <li>The second parameter is the <code class="language-plaintext highlighter-rouge">URL</code> of the page youâ€™re requesting.</li>
  <li>The <strong>optional</strong> third parameter sets whether the request is asynchronous. If TRUE (the default), the execution of the JavaScript function will continue while the response of the server has not yet arrived.</li>
</ul>

<h4 id="send">send()</h4>

<p>The parameter to the <code class="language-plaintext highlighter-rouge">send()</code> method can be any data you want to send to the server if <code class="language-plaintext highlighter-rouge">POST</code>-ing the request.</p>

<hr />

<h2 id="step-2--å¤„ç†æœåŠ¡å™¨è¯·æ±‚">step 2 : å¤„ç†æœåŠ¡å™¨è¯·æ±‚</h2>

<p>When sending the request, you provided the name of a JavaScript function that is designed to handle the response.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">nameOfTheFunction</span><span class="p">;</span>
</code></pre></div></div>

<p>First, the function needs to check for the state of the request.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">XMLHTTPRequest</span><span class="p">.</span><span class="nx">DONE</span><span class="p">){</span>
    <span class="c1">//everything is good, the response is received</span>
    <span class="c1">// or httpRequest.readState === 4</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1">//not ready</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The full list of the <code class="language-plaintext highlighter-rouge">readyState</code> values is as follows:</p>

<ul>
  <li>0 è¡¨ç¤ºæœªåˆå§‹åŒ–ã€‚å°šæœªè°ƒç”¨ open() æ–¹æ³•</li>
  <li>1 è¡¨ç¤ºæ­£åœ¨åŠ è½½ã€‚å·²ç»è°ƒç”¨ open() æ–¹æ³•ï¼Œä½†æœªè°ƒç”¨ send() æ–¹æ³•</li>
  <li>2 è¡¨ç¤ºåŠ è½½å®Œæ¯•ã€‚å·²ç»è°ƒç”¨ send() æ–¹æ³•ï¼Œä½†å°šæœªæ¥æ”¶åˆ°å“åº”</li>
  <li>3 è¡¨ç¤ºæ­£åœ¨äº¤äº’ã€‚å·²ç»æ¥æ”¶åˆ°éƒ¨åˆ†å“åº”æ•°æ®</li>
  <li>4 è¡¨ç¤ºå®Œæˆã€‚ å·²ç»æ¥æ”¶åˆ°å…¨éƒ¨å“åº”æ•°æ®ï¼Œè€Œä¸”å¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨äº†ã€‚</li>
</ul>

<blockquote>
  <p>æ¥æ”¶åˆ°å“åº”åï¼Œå“åº”çš„æ•°æ®ä¼šè‡ªåŠ¨å¡«å…… XMLHttpRequest å¯¹è±¡çš„å±æ€§</p>
</blockquote>

<ul>
  <li>responseText: ä½œä¸ºå“åº”ä¸»ä½“è¢«è¿”å›çš„æ–‡æœ¬</li>
  <li>responseXML: å“åº”æ•°æ®çš„å†…å®¹ç±»å‹æ˜¯ â€œtext/xmlâ€ æˆ– â€œapplication/xmlâ€</li>
  <li>status: å“åº”çš„ HTTP çŠ¶æ€</li>
  <li>statusText: HTTP çŠ¶æ€çš„è¯´æ˜</li>
</ul>

<p>The next thing to check is the response code of the HTTP server response.</p>

<p>For example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// perfect!</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// there was a problem with the request,</span>
    <span class="c1">// for example the response may contain a 404 (Not Found)</span>
    <span class="c1">// or 500 (Internal Server Error) response code</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now after youâ€™ve checked the state of the request and the HTTP status code of the response, itâ€™s up to you to do whatever you want with the data the server has sent to you. You have two options to access that data(ä½ æœ‰ä¸¤ç§æ–¹å¼æ¥è·å–æ•°æ®):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">httpRequest.responseText</code> â€“ returns the server response as a string of text</li>
  <li><code class="language-plaintext highlighter-rouge">httpRequest.responseXML</code> â€“ returns the response as an XMLDocument object you can traverse using the JavaScript DOM functions(è¿™ä¸ªå±æ€§ç”¨äºä¿å­˜<code class="language-plaintext highlighter-rouge">Content-Type</code>å¤´éƒ¨ä¸­æŒ‡å®šä¸ºâ€<code class="language-plaintext highlighter-rouge">text/xml</code>â€œçš„æ•°æ®ï¼Œå…¶å®æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">DocumentFragment</code>å¯¹è±¡ï¼Œå¯ä»¥ç”¨å„ç§<code class="language-plaintext highlighter-rouge">DOM</code>æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªå¯¹è±¡)</li>
</ul>

<hr />

<h2 id="ä½¿ç”¨æ•°æ®">ä½¿ç”¨æ•°æ®</h2>

<p>Finally, We can send some data to the server and receive a response.</p>

<hr />

<h2 id="å–æ¶ˆå¼‚æ­¥è¯·æ±‚">å–æ¶ˆå¼‚æ­¥è¯·æ±‚</h2>

<p>åœ¨æ¥æ”¶åˆ°å“åº”ä¹‹å‰è¿˜å¯ä»¥è°ƒç”¨ <code class="language-plaintext highlighter-rouge">abort()</code> æ–¹æ³•æ¥å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">httpRequest</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
</code></pre></div></div>

<hr />

<h2 id="example">example</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getNewContent</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">){</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">example.txt</span><span class="dl">"</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">para</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
                <span class="nx">para</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">new</span><span class="dl">'</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">para</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Sorry, your browser doesn</span><span class="se">\'</span><span class="s1">t support XMLHttpRequest</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>å›è°ƒå‡½æ•°ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬åªéœ€é€šè¿‡ <code class="language-plaintext highlighter-rouge">readyState === 4</code> åˆ¤æ–­è¯·æ±‚æ˜¯å¦å®Œæˆã€‚å¦‚æœå·²å®Œæˆï¼Œå†æ ¹æ® <code class="language-plaintext highlighter-rouge">status === 200</code> åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæˆåŠŸçš„å“åº”ã€‚</p>
</blockquote>

<hr />

<h2 id="ajax-è·¨åŸŸ">Ajax è·¨åŸŸ</h2>

<p>é€šè¿‡ XHR å®ç° Ajax é€šä¿¡çš„ä¸€ä¸ªä¸»è¦é™åˆ¶ï¼Œæ¥æºäºè·¨åŸŸå®‰å…¨ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒXHR å¯¹è±¡åªèƒ½è®¿é—®ä¸åŒ…å«å®ƒçš„é¡µé¢ä½äºåŒä¸€ä¸ªåŸŸä¸­çš„èµ„æºã€‚</p>

<p>CORS (Cross-Origin Resource Sharing, è·¨åŸŸæºèµ„æºå…±äº«) æ˜¯ W3C çš„ä¸€ä¸ªå·¥ä½œè‰æ¡ˆï¼Œå®šä¹‰äº†åœ¨å¿…é¡»è®¿é—®è·¨åŸŸèµ„æºæ—¶ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨å¦‚ä½•æ²Ÿé€šã€‚CORS èƒŒåçš„æ€æƒ³æ˜¯ï¼š<strong>ä½¿ç”¨è‡ªå®šä¹‰çš„ HTTP å¤´éƒ¨è®©æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šï¼Œä»è€Œå†³å®šè¯·æ±‚æˆ–å“åº”æ˜¯åº”è¯¥æˆåŠŸè¿˜æ˜¯åº”è¯¥å¤±è´¥</strong>ã€‚</p>

<h3 id="ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚</h3>

<p>æ¯”å¦‚ï¼Œåœ¨å‘é€ç®€å•è¯·æ±‚æ—¶ï¼Œéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª origin å¤´éƒ¨ï¼Œå…¶ä¸­åŒ…å«è¯·æ±‚é¡µé¢çš„æºä¿¡æ¯(åè®®ã€åŸŸåæˆ–ç«¯å£)ï¼Œä»¥ä¾¿æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå¤´éƒ¨ä¿¡æ¯æ¥å†³å®šæ˜¯å¦ç»™äºˆå“åº”ã€‚</p>

<pre><code class="language-txt">Origin: http://xiaokedada.com
</code></pre>

<p>å¦‚æœæœåŠ¡å™¨è®¤ä¸ºè¿™ä¸ªè¯·æ±‚å¯ä»¥æ¥å—ï¼Œå°±åœ¨ Access-Control-Allow-Origin å¤´éƒ¨ä¸­å›å‘ç›¸åŒçš„æºä¿¡æ¯ã€‚</p>

<pre><code class="language-txt">Access-Control-Allow-Origin: http://xiaokedada.com
</code></pre>

<p>å¦‚æœæ²¡æœ‰è¿™ä¸ªå¤´éƒ¨ï¼Œæˆ–è€…æœ‰è¿™ä¸ªå¤´éƒ¨ä½†æºä¿¡æ¯ä¸åŒ¹é…ï¼Œæµè§ˆå™¨å°±ä¼šé©³å›è¯·æ±‚ã€‚</p>

<p>IE é€šè¿‡å¼•å…¥ XDR(XDomainRequest) ç±»å‹å®ç° CORSã€‚å…¶ä»–æµè§ˆå™¨å¯¹ CORS çš„å®ç°æ˜¯<strong>ä½¿ç”¨æ ‡å‡†çš„ XHR å¯¹è±¡å¹¶åœ¨ open() æ–¹æ³•ä¸­ä¼ å…¥ç»å¯¹ URL</strong>ã€‚</p>

<h3 id="éç®€å•è¯·æ±‚">éç®€å•è¯·æ±‚</h3>

<p>CORS é€šè¿‡ä¸€ç§å«åš Preflighted Requests çš„é€æ˜æœåŠ¡å™¨éªŒè¯æœºåˆ¶æ”¯æŒå¼€å‘äººå‘˜ä½¿ç”¨è‡ªå®šä¹‰çš„å¤´éƒ¨ã€GET æˆ– POST ä¹‹å¤–çš„æ–¹æ³•ï¼Œä»¥åŠä¸åŒç±»å‹çš„ä¸»ä½“å†…å®¹ã€‚è¿™ç§è¯·æ±‚ä½¿ç”¨ OPTIONS æ–¹æ³•ï¼Œå‘é€ä¸‹åˆ—å¤´éƒ¨ï¼š</p>

<ul>
  <li>Origin: ä¸ç®€å•è¯·æ±‚ä¸€è‡´</li>
  <li>Access-Control-Request-Method: è¯·æ±‚è‡ªèº«ä½¿ç”¨çš„æ–¹æ³•</li>
  <li>Access-Control-Request-Headers: (å¯é€‰) è‡ªå®šä¹‰å¤´éƒ¨ä¿¡æ¯</li>
</ul>

<p>å‘é€è¿™ä¸ªè¯·æ±‚åï¼ŒæœåŠ¡å™¨å¯ä»¥å†³å®šæ˜¯å¦å…è®¸è¿™ç§ç±»å‹çš„è¯·æ±‚ã€‚åœ¨å“åº”ä¸­å‘é€å¦‚ä¸‹å¤´éƒ¨ä¸æµè§ˆå™¨è¿›è¡Œæ²Ÿé€šã€‚</p>

<ul>
  <li>Access-Control-Allow-Origin: ä¸ç®€å•è¯·æ±‚ä¸€è‡´</li>
  <li>Access-Control-Allow-Methods: å…è®¸çš„æ–¹æ³•</li>
  <li>Access-Control-Allow-Headers: å…è®¸çš„å¤´éƒ¨</li>
  <li>Access-Control-Max-Age: åº”è¯¥å°†è¿™ä¸ª Preflight è¯·æ±‚ç¼“å­˜çš„æ—¶é—´(ç§’)</li>
</ul>

<p>å¼ºçƒˆå»ºè®®å‚è€ƒè¿™ç¯‡æ–‡ç« : <a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</a></p>

<h3 id="jsonp-è·¨åŸŸæŠ€æœ¯">JSONP è·¨åŸŸæŠ€æœ¯</h3>

<p>JSONP (JSON with padding) æ˜¯<strong>åº”ç”¨</strong> JSON çš„ä¸€ç§æ–°æ–¹æ³•ï¼Œåªæ˜¯è¢«åŒ…å«åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„ JSONã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">callback</span><span class="p">({</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">maoxiaoke</span><span class="dl">"</span><span class="p">});</span>
</code></pre></div></div>

<p>JSONP æ˜¯é€šè¿‡åŠ¨æ€ <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> å…ƒç´ æ¥ä½¿ç”¨çš„ï¼Œæ˜¯å› ä¸º <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> è„šæœ¬å…·æœ‰è·¨åŸŸèƒ½åŠ›ã€‚ä¸‹é¢è¿™ä¸ªæ —å­ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">handleResponse</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">(</span><span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://xxx/json/ï¼Ÿcallback=handleResponse</span><span class="dl">"</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="p">(</span><span class="nx">script</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p>å‚è€ƒ: <a href="http://www.jianshu.com/p/82b82d5dd1ea">ajaxè·¨åŸŸï¼Œè¿™åº”è¯¥æ˜¯æœ€å…¨çš„è§£å†³æ–¹æ¡ˆäº†</a></p>
</blockquote>
:ET